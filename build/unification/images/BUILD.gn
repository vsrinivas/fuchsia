# Copyright 2019 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

declare_args() {
  # Use this flag to exclude artifacts from Astro builds.
  # This is a very hacky way of ensuring that the resulting fuchsia.zbi fits
  # within the available space on device.
  # This will soon enough be replaced with a proper way to select image
  # artifacts based on board / product properties.
  # Artifacts that are known to not be useful on Astro builds (e.g. drivers for
  # other devices, tests) may be put in `if (!filter_out_of_astro)` blocks.
  # TODO(45680): remove this hack.
  filter_out_of_astro = false

  # Use this flag to include previously excluded artifacts on products based on
  # Astro.
  # Yes, our image building system is so broken that this is currently the only
  # way to accommodate the configurations we run on our infrastructure.
  on_second_thought_keep_on_astro = false
}

# Zircon manifests
#
# This file contains references to binaries either built by the Zircon GN build
# (`legacy-foo` targets) or migrated from that build into the Fuchsia GN build
# (`migrated-foo` targets).

import("aggregate_manifest.gni")
import("artifacts.gni")
import("zircon_artifact.gni")
import("//build/unification/future/data/fini_manifest.gni")

foreach(artifact, zircon_artifacts) {
  zircon_artifact(artifact.name) {
    contents = artifact.lines

    deps = artifact.deps
  }
}

group("images") {
  deps = [
    ":legacy-aux",
    ":legacy-image",
    ":legacy-tests",
    ":migrated-aux",
    ":migrated-image",
    ":migrated-tests",
  ]
}

###############################################################################
# Legacy manifests
#
# These manifests mirror the manifests generated by the ZN build.
#
# Edit these targets if:
#  - a new binary was recently added to the ZN build and needs to be referred
#    to in the GN build - the edit is an addition;
#  - a binary is being migrated from the ZN build into the GN build - the edit
#    should be a removal.

aggregate_manifest("legacy-image") {
  # Though without any dependency, this target is being kept around as its
  # output is needed by support scripts.
  deps = []
}

# IMPORTANT NOTE: this target is now frozen, please do not add any more
# dependencies to it.
aggregate_manifest("legacy-aux") {
  deps = [
    ":lib.c",
    ":test.sys.libc-test",
    ":test.sys.noop-test",
    ":test.sys.noop-test.asan",
    ":test.sys.noop-test.asan-ubsan",
    ":test.sys.noop-test.profile",
    ":test.sys.noop-test.sancov",
    ":test.sys.noop-test.ubsan",
    ":test.sys.noop-test.ubsan-sancov",
    ":test.sys.noop-test.ubsan-sancov-full",
  ]

  reference = "legacy-aux-$target_cpu"
}

# IMPORTANT NOTE: this target is now frozen, please do not add any more
# dependencies to it.
aggregate_manifest("legacy-tests") {
  deps = [
    ":test.sys.libc-test",
    ":test.sys.noop-test",
    ":test.sys.noop-test.asan",
    ":test.sys.noop-test.asan-ubsan",
    ":test.sys.noop-test.profile",
    ":test.sys.noop-test.sancov",
    ":test.sys.noop-test.ubsan",
    ":test.sys.noop-test.ubsan-sancov",
    ":test.sys.noop-test.ubsan-sancov-full",
  ]

  reference = "legacy-tests-$target_cpu"
}

###############################################################################
# Migrated manifests
#
# These manifests list binaries that were migrated from the ZN build into the
# GN build.
#
# Edit these targets if:
#  - a binary is being migrated from the ZN build into the GN build - the edit
#    should be an addition;
#  - a formerly migrated binary is being better integrated into the GN build
#    using idiomatic constructs - the edit should be a removal.

fini_manifest("migrated-image") {
  # Use the same naming scheme as `aggregate_manifest`.
  outputs = [ "$target_out_dir/$target_name.unification.manifest" ]

  deps = [
    "//examples/drivers//fifo:demo-fifo",
    "//src/bringup/bin/debuglog",
    "//src/connectivity/bluetooth/hci/transport/uart:bt-transport-uart",
    "//src/connectivity/bluetooth/hci/transport/usb:bt-transport-usb",
    "//src/connectivity/bluetooth/hci/vendor/broadcom:bt-hci-broadcom",
    "//src/connectivity/bluetooth/hci/vendor/mediatek:bt-hci-mediatek",
    "//src/connectivity/ethernet/drivers/aml-ethernet-s912",
    "//src/connectivity/ethernet/drivers/asix-88179",
    "//src/connectivity/ethernet/drivers/asix-88772b",
    "//src/connectivity/ethernet/drivers/dwmac",
    "//src/connectivity/ethernet/drivers/ethernet",
    "//src/connectivity/ethernet/drivers/ethertap",
    "//src/connectivity/ethernet/drivers/realtek-8211f",
    "//src/connectivity/ethernet/drivers/rndis",
    "//src/connectivity/ethernet/drivers/usb-cdc-ecm",
    "//src/connectivity/ethernet/drivers/usb-cdc-ecm",
    "//src/connectivity/ethernet/drivers/usb-cdc-function",
    "//src/connectivity/ethernet/drivers/usb-cdc-function",
    "//src/connectivity/network/drivers/network-device",
    "//src/developer/cmd:bin",
    "//src/devices/bin/driverctl",
    "//src/devices/bin/lsdev",
    "//src/devices/bin/unbind",
    "//src/devices/block/bin/biotime",
    "//src/devices/block/bin/blktest",
    "//src/devices/block/bin/disk-inspect",
    "//src/devices/block/bin/fvm-check",
    "//src/devices/block/bin/gpt",
    "//src/devices/block/bin/iochk",
    "//src/devices/block/bin/iotime",
    "//src/devices/block/bin/lsblk",
    "//src/devices/block/bin/sdio",
    "//src/devices/block/drivers/ahci",
    "//src/devices/block/drivers/aml-sd-emmc",
    "//src/devices/block/drivers/bootpart",
    "//src/devices/block/drivers/core",
    "//src/devices/block/drivers/ftl",
    "//src/devices/block/drivers/fvm",
    "//src/devices/block/drivers/gpt",
    "//src/devices/block/drivers/hisi-ufs",
    "//src/devices/block/drivers/mbr",
    "//src/devices/block/drivers/nvme",
    "//src/devices/block/drivers/pci-sdhci",
    "//src/devices/block/drivers/ramdisk",
    "//src/devices/block/drivers/sdhci",
    "//src/devices/block/drivers/sdmmc",
    "//src/devices/block/drivers/ums-function",
    "//src/devices/block/drivers/usb-mass-storage",
    "//src/devices/block/drivers/zxcrypt",
    "//src/devices/board/drivers/integration-test",
    "//src/devices/board/drivers/machina",
    "//src/devices/bus/drivers/pci:bus-pci",
    "//src/devices/bus/drivers/pci:bus-pci.proxy",
    "//src/devices/bus/drivers/platform:platform-bus",
    "//src/devices/bus/drivers/platform:platform-bus.proxy",
    "//src/devices/clock/bin/clock:clkctl",
    "//src/devices/clock/bin/clock",
    "//src/devices/clock/drivers/amlogic-clk",
    "//src/devices/clock/drivers/clock",
    "//src/devices/cpu/bin/cpuctl",
    "//src/devices/cpu/drivers/aml-cpu",
    "//src/devices/fw/drivers/qcom-pil",
    "//src/devices/gpio/bin/gpioutil",
    "//src/devices/gpio/drivers/aml-axg-gpio",
    "//src/devices/gpio/drivers/aml-gxl-gpio",
    "//src/devices/gpio/drivers/gpio",
    "//src/devices/i2c/bin:i2cutil",
    "//src/devices/i2c/bin/i2c",
    "//src/devices/i2c/drivers/aml-i2c",
    "//src/devices/i2c/drivers/i2c",
    "//src/devices/i2c/drivers/intel-i2c",
    "//src/devices/light-sensor/drivers/ams-light",
    "//src/devices/light-sensor/drivers/lite-on",
    "//src/devices/misc/drivers/builtin",
    "//src/devices/misc/drivers/cpu-trace",
    "//src/devices/misc/drivers/ktrace",
    "//src/devices/mlg/drivers/usb-harriet",
    "//src/devices/nand/bin/nand-loader",
    "//src/devices/nand/bin/nand-util",
    "//src/devices/nand/drivers/aml-rawnand",
    "//src/devices/nand/drivers/broker:nand-broker",
    "//src/devices/nand/drivers/nand",
    "//src/devices/nand/drivers/nandpart",
    "//src/devices/nand/drivers/ram-nand",
    "//src/devices/nand/drivers/skip-block",
    "//src/devices/pci/drivers/amlogic-pcie",
    "//src/devices/power/bin/lspwr",
    "//src/devices/power/drivers/power",
    "//src/devices/pwm/drivers/aml-pwm",
    "//src/devices/pwm/drivers/aml-pwm-init",
    "//src/devices/pwm/drivers/pwm",
    "//src/devices/ram/bin/ram-info",
    "//src/devices/ram/drivers/aml-ram",
    "//src/devices/rtc/drivers/fallback",
    "//src/devices/rtc/drivers/nxp",
    "//src/devices/rtc/drivers/pl031-rtc",
    "//src/devices/scpi/drivers/aml-scpi-s912:aml-scpi-s912.mailbox",
    "//src/devices/scpi/drivers/aml-scpi-s912:scpi",
    "//src/devices/securemem/drivers/aml-securemem",
    "//src/devices/serial/drivers/aml-uart",
    "//src/devices/serial/drivers/ftdi",
    "//src/devices/serial/drivers/serial",
    "//src/devices/serial/drivers/serial-async",
    "//src/devices/serial/drivers/usb-cdc-acm",
    "//src/devices/shareddma/drivers/syn-dma",
    "//src/devices/spi/bin/spiutil",
    "//src/devices/spi/drivers/aml-spi",
    "//src/devices/spi/drivers/spi",
    "//src/devices/sysmem/drivers/sysmem",
    "//src/devices/tee/drivers/optee",
    "//src/devices/thermal/bin/thermal-cli",
    "//src/devices/thermal/drivers/aml-thermal-s905d2g",
    "//src/devices/thermal/drivers/aml-thermal-s912",
    "//src/devices/usb/bin/lsusb",
    "//src/devices/usb/bin/usb-fwloader",
    "//src/devices/usb/bin/usbctl",
    "//src/devices/usb/drivers/aml-usb-phy-v2",
    "//src/devices/usb/drivers/dwc2",
    "//src/devices/usb/drivers/dwc3",
    "//src/devices/usb/drivers/hikey-usb",
    "//src/devices/usb/drivers/mt-musb-host",
    "//src/devices/usb/drivers/mt-musb-peripheral",
    "//src/devices/usb/drivers/usb-bus",
    "//src/devices/usb/drivers/usb-composite",
    "//src/devices/usb/drivers/usb-dfu",
    "//src/devices/usb/drivers/usb-hub",
    "//src/devices/usb/drivers/usb-peripheral",
    "//src/devices/usb/drivers/usb-peripheral-test",
    "//src/devices/usb/drivers/usb-test/fx3",
    "//src/devices/usb/drivers/usb-test/usb-tester",
    "//src/devices/usb/drivers/usb-virtual-bus",
    "//src/devices/usb/drivers/virtual-bus-tester:virtual-bus-tester-function",
    "//src/devices/usb/drivers/virtual-bus-tester",
    "//src/devices/usb/drivers/xhci-rewrite:xhci",
    "//src/graphics/display/drivers/aml-canvas",
    "//src/graphics/display/drivers/amlogic-display",
    "//src/graphics/display/drivers/display",
    "//src/graphics/display/drivers/dsi-dw",
    "//src/graphics/drivers/aml-gpu",
    "//src/media/audio/drivers/astro-pdm-input",
    "//src/media/audio/drivers/astro-tdm-output",
    "//src/media/audio/drivers/usb-audio",
    "//src/media/audio/tools/audio-driver-ctl:bin",
    "//src/storage/bin/disk-pave:install-disk-image",
    "//src/ui/backlight/bin/backlight",
    "//src/ui/backlight/drivers/ti-lp8556",
    "//src/ui/input/bin/hid",
    "//src/ui/input/drivers/focaltech",
    "//src/ui/input/drivers/goodix",
    "//src/ui/input/drivers/hid",
    "//src/ui/input/drivers/hid-buttons",
    "//src/ui/input/drivers/hidctl",
    "//src/ui/input/drivers/i2c-hid",
    "//src/ui/input/drivers/usb-hid",
    "//src/ui/input/drivers/usb-hid",
    "//src/ui/light/drivers/aml-light",
    "//zircon/system/core/bootsvc:bin",
    "//zircon/system/core/console",
    "//zircon/system/core/devmgr/fragment",
    "//zircon/system/core/devmgr/fragment:fragment.proxy",
    "//zircon/system/core/devmgr/fshost",
    "//zircon/system/core/miscsvc",
    "//zircon/system/core/netsvc:device-name-provider",
    "//zircon/system/core/netsvc",
    "//zircon/system/core/ptysvc",
    "//zircon/system/core/pwrbtn-monitor",
    "//zircon/system/core/svchost",
    "//zircon/system/core/sysinfo",
    "//zircon/system/uapp/blobfs",
    "//zircon/system/uapp/crasher",
    "//zircon/system/uapp/dd",
    "//zircon/system/uapp/df",
    "//zircon/system/uapp/dlog",
    "//zircon/system/uapp/fs-fsck:fsck",
    "//zircon/system/uapp/fs-mkfs:mkfs",
    "//zircon/system/uapp/fs-mount:mount",
    "//zircon/system/uapp/fs-umount:umount",
    "//zircon/system/uapp/ihda",
    "//zircon/system/uapp/kcounter",
    "//zircon/system/uapp/kstress",
    "//zircon/system/uapp/ktrace",
    "//zircon/system/uapp/loadgen",
    "//zircon/system/uapp/lz4",
    "//zircon/system/uapp/minfs",
    "//zircon/system/uapp/mutex_pi_exerciser",
    "//zircon/system/uapp/ping",
    "//zircon/system/uapp/psutils:handles",
    "//zircon/system/uapp/psutils:kill",
    "//zircon/system/uapp/psutils:killall",
    "//zircon/system/uapp/psutils:kstats",
    "//zircon/system/uapp/psutils:memgraph",
    "//zircon/system/uapp/psutils:ps",
    "//zircon/system/uapp/psutils:signal",
    "//zircon/system/uapp/psutils:threads",
    "//zircon/system/uapp/psutils:top",
    "//zircon/system/uapp/psutils:vmaps",
    "//zircon/system/uapp/psutils:vmos",
    "//zircon/system/uapp/run-vc",
    "//zircon/system/uapp/runtests",
    "//zircon/system/uapp/spawn",
    "//zircon/system/uapp/storage-metrics",
    "//zircon/system/uapp/syscall-check",
    "//zircon/system/uapp/tee-test",
    "//zircon/system/uapp/trace-benchmark",
    "//zircon/system/uapp/trace-example",
    "//zircon/system/uapp/waitfor",
    "//zircon/system/uapp/watch",
    "//zircon/system/ulib/driver-info/app:driverinfo",
    "//zircon/third_party/dev/ethernet/e1000",
    "//zircon/third_party/uapp/dash",
    "//zircon/third_party/uapp/fsck-msdosfs",
    "//zircon/third_party/uapp/kilo",
    "//zircon/third_party/uapp/mkfs-msdosfs",
  ]

  if (target_cpu == "arm64") {
    deps += [ "//src/devices/board/drivers/astro" ]
  } else if (target_cpu == "x64") {
    deps += [
      "//src/connectivity/ethernet/drivers/intel-ethernet",
      "//src/connectivity/ethernet/drivers/realtek-8111",
      "//src/devices/board/drivers/x86:platform-bus-x86",
      "//src/devices/misc/drivers/tpm",
      "//src/devices/rtc/drivers/intel-rtc",
      "//src/devices/serial/drivers/intel-serialio",
      "//src/devices/serial/drivers/uart16550",
      "//src/graphics/display/drivers/intel-i915",
      "//src/ui/input/drivers/pc-ps2",
      "//zircon/system/uapp/acpidump",
    ]
  }

  if (!filter_out_of_astro || on_second_thought_keep_on_astro) {
    deps += [
      "//src/connectivity/ethernet/drivers/asix-88179:fake-asix-88179",
      "//src/connectivity/ethernet/drivers/virtio:virtio_ethernet",
      "//src/devices/block/drivers/as370-sdhci",
      "//src/devices/block/drivers/msm8x53-sdhci",
      "//src/devices/block/drivers/mtk-sdmmc",
      "//src/devices/block/drivers/virtio:virtio_block",
      "//src/devices/block/drivers/virtio:virtio_scsi",
      "//src/devices/board/drivers/qemu-arm64",
      "//src/devices/clock/drivers/as370-clk",
      "//src/devices/clock/drivers/hisi3660",
      "//src/devices/clock/drivers/msm8x53-clk",
      "//src/devices/clock/drivers/mtk-clk",
      "//src/devices/clock/drivers/vs680-clk",
      "//src/devices/gpio/drivers/as370-gpio",
      "//src/devices/gpio/drivers/gpio-test",
      "//src/devices/gpio/drivers/hi3660-gpio",
      "//src/devices/gpio/drivers/mt-8167",
      "//src/devices/gpio/drivers/qcom-gpio",
      "//src/devices/i2c/drivers/dw-i2c",
      "//src/devices/i2c/drivers/mt8167-i2c",
      "//src/devices/misc/drivers/test",
      "//src/devices/misc/drivers/virtio-rng:virtio_rng",
      "//src/devices/misc/drivers/virtio-socket:virtio_socket",
      "//src/devices/nand/drivers/cadence-hpnfc",
      "//src/devices/power/drivers/as370-power",
      "//src/devices/power/drivers/msm8x53-power",
      "//src/devices/power/drivers/mtk-power",
      "//src/devices/power/drivers/power:power-test",
      "//src/devices/power/drivers/vs680-power",
      "//src/devices/serial/bin/serial-test",
      "//src/devices/serial/drivers/ftdi:ftdi-fake-usb",
      "//src/devices/serial/drivers/usb-cdc-acm:fake-usb-cdc-acm",
      "//src/devices/serial/drivers/virtio-console:virtio_console",
      "//src/devices/spi/drivers/dw-spi",
      "//src/devices/spi/drivers/mtk-spi",
      "//src/devices/tests/bind-debugger-test:bind-debugger-test-driver",
      "//src/devices/tests/crash-device",
      "//src/devices/tests/ddk-lifecycle:ddk-lifecycle-test",
      "//src/devices/tests/ddk-power:ddk-power-test-child",
      "//src/devices/tests/ddk-power:ddk-power-test",
      "//src/devices/tests/ddk-runcompatibilityhook:ddk-runcompatibilityhook-test-child",
      "//src/devices/tests/ddk-runcompatibilityhook:ddk-runcompatibilityhook-test",
      "//src/devices/tests/ddk-schedule-work:ddk-schedule-work-perf",
      "//src/devices/tests/ddk-schedule-work:ddk-schedule-work-test",
      "//src/devices/tests/devhost-test:devhost-test-child",
      "//src/devices/tests/devhost-test",
      "//src/devices/tests/devhost-test:devhost-test-manual",
      "//src/devices/tests/fidl-async-llcpp-driver",
      "//src/devices/tests/fidl-llcpp-driver",
      "//src/devices/tests/isolateddevmgr:isolateddevmgr-test",
      "//src/devices/tests/mock-device",
      "//src/devices/tests/sysdev",
      "//src/devices/tests/unit-test-test:unit-test-fail",
      "//src/devices/tests/unit-test-test:unit-test-pass",
      "//src/devices/thermal/drivers/as370-thermal",
      "//src/devices/thermal/drivers/mtk-thermal",
      "//src/devices/thermal/drivers/vs680-thermal",
      "//src/devices/usb/bin/xdc-test",
      "//src/devices/usb/drivers/as370-usb-phy",
      "//src/devices/usb/drivers/nelson-usb-phy",
      "//src/devices/usb/drivers/usb-bus:usb-device",
      "//src/devices/usb/drivers/usb-test/flash-programmer",
      "//src/graphics/display/drivers/dsi-mt",
      "//src/graphics/display/drivers/fake:fake-display",
      "//src/graphics/display/drivers/goldfish-display",
      "//src/graphics/display/drivers/hikey-display",
      "//src/graphics/display/drivers/mt8167s-display",
      "//src/graphics/display/drivers/simple:simple.amd-kaveri",
      "//src/graphics/display/drivers/simple:simple.bochs",
      "//src/graphics/display/drivers/simple:simple.intel",
      "//src/graphics/display/drivers/simple:simple.nv",
      "//src/graphics/display/drivers/simple:simple.vmware",
      "//src/graphics/display/drivers/ssd1306",
      "//src/graphics/display/drivers/vim-display",
      "//src/graphics/drivers/virtio:virtio_gpu",
      "//src/media/audio/drivers/alc5514",
      "//src/media/audio/drivers/alc5663",
      "//src/media/audio/drivers/as370-pdm-input",
      "//src/media/audio/drivers/as370-tdm-output",
      "//src/media/audio/drivers/codecs/max98373",
      "//src/media/audio/drivers/codecs/tas5782",
      "//src/media/audio/drivers/codecs/tas5805",
      "//src/media/audio/drivers/gauss-pdm-input",
      "//src/media/audio/drivers/gauss-tdm",
      "//src/media/audio/drivers/intel-hda/codecs/hdmi:hdmi-audio-codec",
      "//src/media/audio/drivers/intel-hda/codecs/qemu:qemu-audio-codec",
      "//src/media/audio/drivers/intel-hda/codecs/realtek:realtek-audio-codec",
      "//src/media/audio/drivers/intel-hda/controller:intel-hda",
      "//src/media/audio/drivers/max98927",
      "//src/media/audio/drivers/mt8167-tdm-input",
      "//src/media/audio/drivers/mt8167-tdm-output",
      "//src/media/audio/drivers/nelson-pdm-input",
      "//src/media/audio/drivers/nelson-tdm-output",
      "//src/media/audio/drivers/sherlock-pdm-input",
      "//src/media/audio/drivers/sherlock-tdm-output",
      "//src/media/audio/tools/audio-driver-ctl:test",
      "//src/ui/backlight/drivers/sg-micro",
      "//src/ui/input/drivers/bma253",
      "//src/ui/input/drivers/cypress",
      "//src/ui/input/drivers/usb-hid:fake",
      "//src/ui/input/drivers/virtio:virtio_input",
      "//src/ui/light/drivers/gpio-light",
      "//src/ui/light/drivers/lp50xx-light",
      "//zircon/system/utest/platform-bus:test-audio-codec",
      "//zircon/system/utest/platform-bus:test-board",
      "//zircon/system/utest/platform-bus:test-child-1",
      "//zircon/system/utest/platform-bus:test-child-2",
      "//zircon/system/utest/platform-bus:test-child-2.proxy",
      "//zircon/system/utest/platform-bus:test-child-3",
      "//zircon/system/utest/platform-bus:test-clock",
      "//zircon/system/utest/platform-bus:test-composite",
      "//zircon/system/utest/platform-bus:test-gpio",
      "//zircon/system/utest/platform-bus:test-i2c",
      "//zircon/system/utest/platform-bus:test-parent",
      "//zircon/system/utest/platform-bus:test-power",
      "//zircon/system/utest/platform-bus:test-pwm",
      "//zircon/system/utest/platform-bus:test-spi",
    ]

    if (target_cpu == "arm64") {
      deps += [
        "//src/devices/board/drivers/as370",
        "//src/devices/board/drivers/c18",
        "//src/devices/board/drivers/gauss:gauss-i2c-test",
        "//src/devices/board/drivers/gauss",
        "//src/devices/board/drivers/hikey960:hi3660-i2c-test",
        "//src/devices/board/drivers/hikey960",
        "//src/devices/board/drivers/msm8998",
        "//src/devices/board/drivers/msm8x53-som",
        "//src/devices/board/drivers/mt8167s_ref",
        "//src/devices/board/drivers/nelson",
        "//src/devices/board/drivers/qemu-arm64",
        "//src/devices/board/drivers/sherlock",
        "//src/devices/board/drivers/vim2",
        "//src/devices/board/drivers/vim3",
        "//src/devices/board/drivers/vs680-evk",
      ]
    }
  }
}

fini_manifest("migrated-aux") {
  # Use the same naming scheme as `aggregate_manifest`.
  outputs = [ "$target_out_dir/$target_name.unification.manifest" ]

  deps = [
    "//src/connectivity/ethernet/drivers/usb-cdc-ecm:usb-cdc-ecm-unittest",
    "//src/devices/block/bin/biotime:biotime-test",
    "//src/devices/block/drivers/ahci:ahci-unittest",
    "//src/devices/block/drivers/core:core-unittest",
    "//src/devices/block/drivers/gpt:gpt-device-test",
    "//src/devices/block/drivers/mbr:mbr-test",
    "//src/devices/board/drivers/mt8167s_ref:mt8167s_ref-test",
    "//src/devices/bus/drivers/pci/test:pci-driver",
    "//src/devices/bus/lib/device-protocol-pdev/test:device-protocol-pdev-test",
    "//src/devices/clock/drivers/amlogic-clk:amlogic-clk-test",
    "//src/devices/clock/drivers/msm8x53-clk:msm8x53-clk-test",
    "//src/devices/cpu/drivers/aml-cpu:aml-cpu-test",
    "//src/devices/gpio/drivers/aml-axg-gpio:aml-axg-gpio-test",
    "//src/devices/lib/as370/test:audio-dsp-test",
    "//src/devices/lib/as370/test:syn-audio-in-test",
    "//src/devices/lib/mt8167/test:mt8167-audio-lib-test",
    "//src/devices/nand/drivers/ram-nand:ram-nand-test",
    "//src/devices/pci/lib/device-protocol-pci/test:device-protocol-pci",
    "//src/devices/power/drivers/as370-power:as370-power-test",
    "//src/devices/power/drivers/msm8x53-power:msm8x53-power-test",
    "//src/devices/rtc/drivers/fallback:fallback-rtc",
    "//src/devices/securemem/drivers/aml-securemem:aml-securemem-test",
    "//src/devices/serial/drivers/uart16550:uart16550-test",
    "//src/devices/spi/drivers/mtk-spi:mtk-spi-test",
    "//src/devices/spi/drivers/spi:spi-test",
    "//src/devices/sysmem/tests/sysmem",
    "//src/devices/tee/drivers/optee:optee-message-test",
    "//src/devices/tests/crash-device",
    "//src/devices/tests/ddk-fidl-test",
    "//src/devices/tests/ddk-lifecycle",
    "//src/devices/tests/ddk-power",
    "//src/devices/tests/ddk-runcompatibilityhook",
    "//src/devices/tests/ddk-schedule-work",
    "//src/devices/tests/devfs",
    "//src/devices/tests/devhost-test",
    "//src/devices/tests/mock-device",
    "//src/devices/tests/sysdev",
    "//src/devices/thermal/bin/thermal-cli",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-request-queue-test",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-test",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-transaction-test",
    "//src/devices/usb/lib/usb/test:usb-desc-lib-test",
    "//src/devices/usb/lib/usb/test:usb-request-test",
    "//src/devices/usb/lib/usb/test:usb-wrapper-test",
    "//src/media/audio/drivers/alc5663",
    "//src/media/audio/tools/audio-driver-ctl:test",
    "//src/storage/lib/paver/test:paver-test",
    "//src/ui/backlight/drivers/sg-micro:sgm37603a-test",
    "//src/ui/backlight/drivers/ti-lp8556:ti-lp8556-test",
    "//src/ui/backlight/tests:backlight-test",
    "//zircon/system/core/bootsvc/test:bootsvc-unit-test",
    "//zircon/system/core/console:console-test",
    "//zircon/system/core/devmgr/fshost:block-watcher-test",
    "//zircon/system/core/devmgr/fshost:fshost-metrics-test",
    "//zircon/system/core/devmgr/fshost:fshost-test",
    "//zircon/system/core/netsvc",
    "//zircon/system/core/netsvc:netsvc-stress-test",
    "//zircon/system/core/netsvc:netsvc-test",
    "//zircon/system/core/ptysvc:ptysvc-test",
    "//zircon/system/core/svchost:crashsvc-test",
    "//zircon/system/uapp/blobfs",
    "//zircon/system/uapp/minfs",
    "//zircon/system/ulib/blobfs/test:blobfs-integration",
    "//zircon/system/ulib/blobfs/test:blobfs-integration-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-fragmentation",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-fragmentation-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-no-space",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-no-space-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-short",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-short-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-use-second-bitmap",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-use-second-bitmap-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-unit",
    "//zircon/system/ulib/block-client/test:block-client-unit",
    "//zircon/system/ulib/c/test:atexit",
    "//zircon/system/ulib/c/test:debugdata",
    "//zircon/system/ulib/c/test:default-stack-size-default",
    "//zircon/system/ulib/c/test:default-stack-size-phdr",
    "//zircon/system/ulib/c/test:posix-clocks",
    "//zircon/system/ulib/c/test/sanitizer:sanitizer-utils",
    "//zircon/system/ulib/devmgr-integration-test/test:devmgr-integration",
    "//zircon/system/ulib/disk_inspector/test:disk_inspector_unit",
    "//zircon/system/ulib/driver-integration-test/test:driver-integration",
    "//zircon/system/ulib/elf-search/test:elf-search",
    "//zircon/system/ulib/fdio/test:fdio",
    "//zircon/system/ulib/fdio/test/constructors:fdio-constructor",
    "//zircon/system/ulib/fidl-async/test:fidl-async-test",
    "//zircon/system/ulib/fit/test:fit",
    "//zircon/system/ulib/fs/journal/test:journal-unit",
    "//zircon/system/ulib/fs/metrics/test:metrics-cobalt",
    "//zircon/system/ulib/fs/metrics/test:metrics-composite-latency-event",
    "//zircon/system/ulib/fs/metrics/test:metrics-inspect",
    "//zircon/system/ulib/fs/test_support/test:fs_test_support",
    "//zircon/system/ulib/ftl/test:ftl_test",
    "//zircon/system/ulib/inspect/test:inspect",
    "//zircon/system/ulib/io-scheduler/test:io-scheduler-test",
    "//zircon/system/ulib/lazy_init/test:lazy_init-test",
    "//zircon/system/ulib/libabr/test:libabr-test",
    "//zircon/system/ulib/libzbi/test:zbi",
    "//zircon/system/ulib/minfs/allocator/test:minfs-allocator-unit",
    "//zircon/system/ulib/minfs/test:minfs-integration",
    "//zircon/system/ulib/minfs/test:minfs-power",
    "//zircon/system/ulib/minfs/test:minfs-unit",
    "//zircon/system/ulib/mock-function/test:mock-function-test",
    "//zircon/system/ulib/perftest/test:perftest",
    "//zircon/system/ulib/range/test:range",
    "//zircon/system/ulib/storage-metrics/test:storage-metrics",
    "//zircon/system/ulib/storage/buffer/test:storage_buffer",
    "//zircon/system/ulib/storage/operation/test:storage_operation",
    "//zircon/system/ulib/sysconfig-client/test:sysconfig-sync-client-test",
    "//zircon/system/ulib/tftp/test:tftp-test",
    "//zircon/system/ulib/trace-engine/test",
    "//zircon/system/ulib/trace-provider/test",
    "//zircon/system/ulib/uart/test:uart-unittests",
    "//zircon/system/ulib/unittest/test:unittest",
    "//zircon/system/ulib/zbi-bootfs/test:zbi-bootfs-test",
    "//zircon/system/utest/core:c11-condvar",
    "//zircon/system/utest/core:c11-mutex",
    "//zircon/system/utest/core:c11-thread",
    "//zircon/system/utest/core:channel",
    "//zircon/system/utest/core:channel-write-etc",
    "//zircon/system/utest/core:clock",
    "//zircon/system/utest/core:debug",
    "//zircon/system/utest/core:elf-tls",
    "//zircon/system/utest/core:event-pair",
    "//zircon/system/utest/core:fifo",
    "//zircon/system/utest/core:fpu",
    "//zircon/system/utest/core:futex",
    "//zircon/system/utest/core:handle-close",
    "//zircon/system/utest/core:handle-dup",
    "//zircon/system/utest/core:handle-info",
    "//zircon/system/utest/core:handle-transfer",
    "//zircon/system/utest/core:handle-wait",
    "//zircon/system/utest/core:job",
    "//zircon/system/utest/core:memory-mapping",
    "//zircon/system/utest/core:object-child",
    "//zircon/system/utest/core:object-info",
    "//zircon/system/utest/core:object-wait",
    "//zircon/system/utest/core:pager",
    "//zircon/system/utest/core:port",
    "//zircon/system/utest/core:process",
    "//zircon/system/utest/core:pthread-barrier",
    "//zircon/system/utest/core:pthread",
    "//zircon/system/utest/core:pthread-tls",
    "//zircon/system/utest/core:socket",
    "//zircon/system/utest/core:stack",
    "//zircon/system/utest/core:stream",
    "//zircon/system/utest/core:sync-completion",
    "//zircon/system/utest/core:sync-condition",
    "//zircon/system/utest/core:sync-mutex",
    "//zircon/system/utest/core:threads",
    "//zircon/system/utest/core:time",
    "//zircon/system/utest/core:version",
    "//zircon/system/utest/core:vmar",
    "//zircon/system/utest/core:vmo",
    "//zircon/system/utest/dlfcn",
    "//zircon/system/utest/evil",
    "//zircon/system/utest/fidl:fidl-handle-policy-test-app",
    "//zircon/system/utest/fidl",
    "//zircon/system/utest/fs",
    "//zircon/system/utest/fs-bench",
    "//zircon/system/utest/fs-management",
    "//zircon/system/utest/fs-recovery",
    "//zircon/system/utest/fs-test-utils",
    "//zircon/system/utest/futex-ownership",
    "//zircon/system/utest/kcounter",
    "//zircon/system/utest/log",
    "//zircon/system/utest/memfs",
    "//zircon/system/utest/minfs-micro-benchmark",
    "//zircon/system/utest/msd",
    "//zircon/system/utest/runtests-utils",
    "//zircon/system/utest/service:service-llcpp-test",
    "//zircon/system/utest/time",
    "//zircon/system/utest/trace",
    "//zircon/system/utest/trace:trace-static-engine",
    "//zircon/system/utest/utc-procargs",
    "//zircon/system/utest/vdso-variant",
    "//zircon/third_party/uapp/fsck-msdosfs",
    "//zircon/third_party/uapp/mkfs-msdosfs",
    "//zircon/third_party/ulib/linenoise/test:linenoise-test",
  ]

  if (target_cpu == "x64") {
    deps += [
      "//src/devices/board/drivers/x86:x86-battery-test",
      "//src/devices/board/drivers/x86:x86-board-test",
      "//src/devices/board/drivers/x86:x86-cros-ec-test",
      "//src/devices/board/drivers/x86:x86-lid-test",
      "//src/devices/board/drivers/x86:x86-pwrsrc-test",
      "//src/devices/board/drivers/x86:x86-thermal-test",
      "//zircon/system/utest/x86-board",
      "//zircon/system/utest/x86-umip",
    ]
  }
}

fini_manifest("migrated-tests") {
  # Use the same naming scheme as `aggregate_manifest`.
  outputs = [ "$target_out_dir/$target_name.unification.manifest" ]

  deps = [
    "//src/connectivity/ethernet/drivers/asix-88179:usb-virtual-bus-asix-88179",
    "//src/connectivity/ethernet/drivers/usb-cdc-ecm:usb-cdc-ecm-unittest",
    "//src/devices/block/bin/biotime:biotime-test",
    "//src/devices/block/drivers/ahci:ahci-unittest",
    "//src/devices/block/drivers/core:core-unittest",
    "//src/devices/block/drivers/gpt:gpt-device-test",
    "//src/devices/block/drivers/mbr:mbr-test",
    "//src/devices/board/drivers/mt8167s_ref:mt8167s_ref-test",
    "//src/devices/bus/drivers/pci/test:pci-driver",
    "//src/devices/bus/lib/device-protocol-pdev/test:device-protocol-pdev-test",
    "//src/devices/clock/drivers/amlogic-clk:amlogic-clk-test",
    "//src/devices/clock/drivers/msm8x53-clk:msm8x53-clk-test",
    "//src/devices/cpu/drivers/aml-cpu:aml-cpu-test",
    "//src/devices/gpio/drivers/aml-axg-gpio:aml-axg-gpio-test",
    "//src/devices/lib/as370/test:audio-dsp-test",
    "//src/devices/lib/as370/test:syn-audio-in-test",
    "//src/devices/lib/mt8167/test:mt8167-audio-lib-test",
    "//src/devices/nand/drivers/ram-nand:ram-nand-test",
    "//src/devices/pci/lib/device-protocol-pci/test:device-protocol-pci",
    "//src/devices/power/drivers/as370-power:as370-power-test",
    "//src/devices/power/drivers/msm8x53-power:msm8x53-power-test",
    "//src/devices/rtc/drivers/fallback:fallback-rtc",
    "//src/devices/securemem/drivers/aml-securemem:aml-securemem-test",
    "//src/devices/serial/drivers/uart16550:uart16550-test",
    "//src/devices/spi/drivers/mtk-spi:mtk-spi-test",
    "//src/devices/spi/drivers/spi:spi-test",
    "//src/devices/sysmem/tests/sysmem",
    "//src/devices/tee/drivers/optee:optee-message-test",
    "//src/devices/tests/crash-device",
    "//src/devices/tests/ddk-fidl-test",
    "//src/devices/tests/ddk-lifecycle",
    "//src/devices/tests/ddk-power",
    "//src/devices/tests/ddk-runcompatibilityhook",
    "//src/devices/tests/ddk-schedule-work",
    "//src/devices/tests/devfs",
    "//src/devices/tests/devhost-test",
    "//src/devices/tests/mock-device",
    "//src/devices/tests/sysdev",
    "//src/devices/thermal/bin/thermal-cli",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-request-queue-test",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-test",
    "//src/devices/usb/drivers/mt-musb-host:mt-hci-transaction-test",
    "//src/devices/usb/lib/usb/test:usb-desc-lib-test",
    "//src/devices/usb/lib/usb/test:usb-request-test",
    "//src/devices/usb/lib/usb/test:usb-wrapper-test",
    "//src/graphics/display/bin/display-factory-test",
    "//src/graphics/display/bin/display-test",
    "//src/media/audio/drivers/alc5663",
    "//src/media/audio/drivers/astro-tdm-output/test:astro-audio-out-test",
    "//src/media/audio/tools/audio-driver-ctl:test",
    "//src/storage/lib/paver/test:paver-test",
    "//src/ui/backlight/drivers/sg-micro:sgm37603a-test",
    "//src/ui/backlight/drivers/ti-lp8556:ti-lp8556-test",
    "//src/ui/backlight/tests:backlight-test",
    "//zircon/system/core/bootsvc/test:bootsvc-unit-test",
    "//zircon/system/core/console:console-test",
    "//zircon/system/core/devmgr/fshost:block-watcher-test",
    "//zircon/system/core/devmgr/fshost:fshost-metrics-test",
    "//zircon/system/core/devmgr/fshost:fshost-test",
    "//zircon/system/core/netsvc:netsvc-stress-test",
    "//zircon/system/core/netsvc:netsvc-test",
    "//zircon/system/core/ptysvc:ptysvc-test",
    "//zircon/system/core/svchost:crashsvc-test",
    "//zircon/system/uapp/blobfs",
    "//zircon/system/uapp/minfs",
    "//zircon/system/ulib/blobfs/test:blobfs-integration",
    "//zircon/system/ulib/blobfs/test:blobfs-integration-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-fragmentation",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-fragmentation-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-no-space",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-no-space-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-short",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-short-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-use-second-bitmap",
    "//zircon/system/ulib/blobfs/test:blobfs-large-integration-use-second-bitmap-paged",
    "//zircon/system/ulib/blobfs/test:blobfs-unit",
    "//zircon/system/ulib/block-client/test:block-client-unit",
    "//zircon/system/ulib/c/test:atexit",
    "//zircon/system/ulib/c/test:debugdata",
    "//zircon/system/ulib/c/test:default-stack-size-default",
    "//zircon/system/ulib/c/test:default-stack-size-phdr",
    "//zircon/system/ulib/c/test:posix-clocks",
    "//zircon/system/ulib/c/test/sanitizer:sanitizer-utils",
    "//zircon/system/ulib/devmgr-integration-test/test:devmgr-integration",
    "//zircon/system/ulib/disk_inspector/test:disk_inspector_unit",
    "//zircon/system/ulib/driver-integration-test/test:driver-integration",
    "//zircon/system/ulib/elf-search/test:elf-search",
    "//zircon/system/ulib/fdio/test:fdio",
    "//zircon/system/ulib/fdio/test/constructors:fdio-constructor",
    "//zircon/system/ulib/fidl-async/test:fidl-async-test",
    "//zircon/system/ulib/fit/test:fit",
    "//zircon/system/ulib/fs/journal/test:journal-unit",
    "//zircon/system/ulib/fs/metrics/test:metrics-cobalt",
    "//zircon/system/ulib/fs/metrics/test:metrics-composite-latency-event",
    "//zircon/system/ulib/fs/metrics/test:metrics-inspect",
    "//zircon/system/ulib/fs/test_support/test:fs_test_support",
    "//zircon/system/ulib/ftl/test:ftl_test",
    "//zircon/system/ulib/inspect/test:inspect",
    "//zircon/system/ulib/io-scheduler/test:io-scheduler-test",
    "//zircon/system/ulib/lazy_init/test:lazy_init-test",
    "//zircon/system/ulib/libabr/test:libabr-test",
    "//zircon/system/ulib/libzbi/test:zbi",
    "//zircon/system/ulib/minfs/allocator/test:minfs-allocator-unit",
    "//zircon/system/ulib/minfs/test:minfs-integration",
    "//zircon/system/ulib/minfs/test:minfs-power",
    "//zircon/system/ulib/minfs/test:minfs-unit",
    "//zircon/system/ulib/mock-function/test:mock-function-test",
    "//zircon/system/ulib/perftest/test:perftest",
    "//zircon/system/ulib/range/test:range",
    "//zircon/system/ulib/storage-metrics/test:storage-metrics",
    "//zircon/system/ulib/storage/buffer/test:storage_buffer",
    "//zircon/system/ulib/storage/operation/test:storage_operation",
    "//zircon/system/ulib/sysconfig-client/test:sysconfig-sync-client-test",
    "//zircon/system/ulib/tftp/test:tftp-test",
    "//zircon/system/ulib/trace-engine/test",
    "//zircon/system/ulib/trace-provider/test",
    "//zircon/system/ulib/uart/test:uart-unittests",
    "//zircon/system/ulib/unittest/test:unittest",
    "//zircon/system/ulib/zbi-bootfs/test:zbi-bootfs-test",
    "//zircon/system/utest/core:c11-condvar",
    "//zircon/system/utest/core:c11-mutex",
    "//zircon/system/utest/core:c11-thread",
    "//zircon/system/utest/core:channel",
    "//zircon/system/utest/core:channel-write-etc",
    "//zircon/system/utest/core:clock",
    "//zircon/system/utest/core:debug",
    "//zircon/system/utest/core:elf-tls",
    "//zircon/system/utest/core:event-pair",
    "//zircon/system/utest/core:fifo",
    "//zircon/system/utest/core:fpu",
    "//zircon/system/utest/core:futex",
    "//zircon/system/utest/core:handle-close",
    "//zircon/system/utest/core:handle-dup",
    "//zircon/system/utest/core:handle-info",
    "//zircon/system/utest/core:handle-transfer",
    "//zircon/system/utest/core:handle-wait",
    "//zircon/system/utest/core:job",
    "//zircon/system/utest/core:memory-mapping",
    "//zircon/system/utest/core:object-child",
    "//zircon/system/utest/core:object-info",
    "//zircon/system/utest/core:object-wait",
    "//zircon/system/utest/core:pager",
    "//zircon/system/utest/core:port",
    "//zircon/system/utest/core:process",
    "//zircon/system/utest/core:pthread-barrier",
    "//zircon/system/utest/core:pthread",
    "//zircon/system/utest/core:pthread-tls",
    "//zircon/system/utest/core:socket",
    "//zircon/system/utest/core:stack",
    "//zircon/system/utest/core:stream",
    "//zircon/system/utest/core:sync-completion",
    "//zircon/system/utest/core:sync-condition",
    "//zircon/system/utest/core:sync-mutex",
    "//zircon/system/utest/core:threads",
    "//zircon/system/utest/core:time",
    "//zircon/system/utest/core:version",
    "//zircon/system/utest/core:vmar",
    "//zircon/system/utest/core:vmo",
    "//zircon/system/utest/dlfcn",
    "//zircon/system/utest/evil",
    "//zircon/system/utest/fidl",
    "//zircon/system/utest/fs",
    "//zircon/system/utest/fs-bench",
    "//zircon/system/utest/fs-management",
    "//zircon/system/utest/fs-recovery",
    "//zircon/system/utest/fs-test-utils",
    "//zircon/system/utest/futex-ownership",
    "//zircon/system/utest/kcounter",
    "//zircon/system/utest/log",
    "//zircon/system/utest/memfs",
    "//zircon/system/utest/minfs-micro-benchmark",
    "//zircon/system/utest/msd",
    "//zircon/system/utest/runtests-utils",
    "//zircon/system/utest/service:service-llcpp-test",
    "//zircon/system/utest/time",
    "//zircon/system/utest/trace",
    "//zircon/system/utest/trace:trace-static-engine",
    "//zircon/system/utest/utc-procargs",
    "//zircon/system/utest/vdso-variant",
    "//zircon/third_party/ulib/linenoise/test:linenoise-test",
  ]

  if (target_cpu == "x64") {
    deps += [
      "//src/devices/board/drivers/x86:x86-battery-test",
      "//src/devices/board/drivers/x86:x86-board-test",
      "//src/devices/board/drivers/x86:x86-cros-ec-test",
      "//src/devices/board/drivers/x86:x86-lid-test",
      "//src/devices/board/drivers/x86:x86-pwrsrc-test",
      "//src/devices/board/drivers/x86:x86-thermal-test",
      "//zircon/system/uapp/acpidump:test",
      "//zircon/system/utest/x86-board",
      "//zircon/system/utest/x86-umip",
    ]
  }
}
